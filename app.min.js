const express=require("express"),ejs=require("ejs"),bodyParser=require("body-parser"),mongoose=require("mongoose"),audioMetaData=require("audio-metadata"),fs=require("fs"),app=express();app.set("view engine","ejs"),app.use(bodyParser.urlencoded({extended:!0})),app.use(express.static("public"));let audioClicked="",metadataArray=[],songDir="",songClickedValue=0;var newSong;app.get("/",(function(req,res){songDir=fs.readdirSync("public/audio/"),songDir.forEach((function(song){var theSong=fs.readFileSync("public/audio/"+song),metadata=audioMetaData.id3v2(theSong);metadataArray.push(metadata)})),""==audioClicked&&(audioClicked=metadataArray[0]),newSong="./audio/"+songDir[songClickedValue],res.render("newindex",{songDir:songDir,metadataArray:metadataArray,audioClicked:audioClicked,newSong:newSong,songClickedValue:songClickedValue})})),app.post("/",(function(req,res){console.log("post request received"),console.log(req.body.songClicked),songClickedValue=req.body.songClicked,audioClicked=metadataArray[req.body.songClicked],res.redirect("/")})),app.post("/backward",(function(req,res){var rewind=req.body.back-1;rewind<0&&(rewind=songDir.length),songClickedValue=rewind,audioClicked=metadataArray[rewind],console.log(rewind),res.redirect("/")})),app.post("/forward",(function(req,res){var skip=parseInt(req.body.front)+1;skip>songDir.length&&(skip=0),songClickedValue=skip,audioClicked=metadataArray[skip],console.log(skip),res.redirect("/")})),app.listen(3e3,(function(){console.log("music app is ready on port 3000")}));